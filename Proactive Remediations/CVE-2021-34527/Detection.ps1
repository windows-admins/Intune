function Test-RegistryKeyValue {
    [CmdletBinding()]
    param(
        [Parameter(Mandatory = $true)]
        [string]
        # The path to the registry key where the value should be set.  Will be created if it doesn't exist.
        $Path,

        [Parameter(Mandatory = $true)]
        [string]
        # The name of the value being set.
        $Name
    )

    if ( -not (Test-Path -Path $Path -PathType Container) ) {
        return $false
    }

    $properties = Get-ItemProperty -Path $Path 
    if ( -not $properties ) {
        return $false
    }

    $member = Get-Member -InputObject $properties -Name $Name
    if ( $member ) {
        return $true
    }
    else {
        return $false
    }

}


try {
    $Printspoolerexist = Test-RegistryKeyValue -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers" -Name "RegisterSpoolerRemoteRpcEndPoint" -ErrorAction Stop
    if ($Printspoolerexist -eq "True") {
        $Printspoolervalue = Get-ItemPropertyValue -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers" -Name "RegisterSpoolerRemoteRpcEndPoint" -ErrorAction Stop
        if ($Printspoolervalue -ne "2") {
            write-host "Print Spooler Remote RPC Connections are enabled, Remediating"
            exit 1  
        }
      
    
        else { 
            Write-Host "Value is set correctly"
            exit 0 
        }
    }
    else {
        Write-Host "Key does not exist, running remediation"
        exit 1
    }
}

catch {
    $errMsg = $_.Exception.Message
    write-host $errMsg
    exit 1
}
